<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="UTF-8" />
  <title>Type of Faith — Lessons</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3E%F0%9F%93%96%3C/text%3E%3C/svg%3E">
  <style>
    /* Light theme */
    :root { --bg:#0f1115; --ink:#e6e6e6; --muted:#a8a8a8; --ok:#6ee7a0; --err:#ff6b81; --accent:#d7c3a0;
            --panel:#151922; --border:#2a2f3a; --banner-bg:#1d2430; --link:#87b3ff; --input-border:#2b3240; --btn-border:#3a4252; }
    /* To switch to light by default, swap the two blocks above/below */
    :root[data-theme="light"] { --bg:#faf8f5; --ink:#111; --muted:#555; --ok:#0a7a0a; --err:#b00020; --accent:#8b6b3b;
            --panel:#fff; --border:#eee; --banner-bg:#fff7e6; --link:#1a56db; --input-border:#ddd; --btn-border:#ccc; }

    *{ box-sizing:border-box }
    body{ font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--ink); margin:24px; }
    a{ color:var(--link) }
    header{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:12px; }
    h1{ margin:0; color:var(--accent) }
    .spacer{ flex:1 }
    select,button,input[type="number"]{ font-size:16px; padding:8px 10px; }
    button{ cursor:pointer; border:1px solid var(--btn-border); background:var(--panel); color:var(--ink); border-radius:6px; }
    button:active{ transform:translateY(1px) }
    .card{ background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:14px; }
    #banner{ font-size:14px; color:var(--accent); background:var(--banner-bg); padding:6px 8px; border-radius:6px; display:none; margin:8px 0; }

    /* Keyboard */
    #keyboard .krow{ margin:2px 0; display:flex; gap:6px; justify-content:center }
    #keyboard .key{
      display:inline-block; min-width:24px; padding:8px 10px; text-align:center;
      border:1px solid var(--border); border-radius:8px; background:var(--panel);
    }
    [data-finger="lp"]{ background:#ffe7e7 } [data-finger="lr"]{ background:#ffeeda }
    [data-finger="lm"]{ background:#fff7cc } [data-finger="li"]{ background:#eaffd1 }
    [data-finger="ri"]{ background:#e0f3ff } [data-finger="rm"]{ background:#eae0ff }
    [data-finger="rr"]{ background:#f5e0ff } [data-finger="rp"]{ background:#fbe0ef }
    .highlight{ outline:2px solid var(--accent) }
    .muted{ color:var(--muted) }
    .row{ display:flex; gap:10px; align-items:center }

    /* Centering & stack */
    .stack-center { display:flex; flex-direction:column; align-items:center; }
    .tips { max-width:820px; width:100%; }
    .drill { max-width:820px; width:100%; margin-top:20px; }
  </style>
</head>
<body>
  <header>
    <h1>Lessons — Type of Faith</h1>
    <div class="spacer"></div>
    <label>Theme:
      <select id="themeMode">
        <option value="auto">Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
      </select>
    </label>
    <a href="index.html"><button title="Back to Practice">Back to Practice</button></a>
  </header>

  <div id="banner"></div>

  <!-- Lesson selector -->
  <div class="card" style="margin-bottom:12px">
    <div class="row">
      <strong>Lesson</strong>
      <select id="lessonSelect"></select>
      <button id="startBtn">Start</button>
      <button id="resetBtn" title="Clear progress for this lesson">Reset Progress</button>
      <span class="spacer"></span>
      <span class="muted">Tip: Aim for ≥95% accuracy before speeding up.</span>
    </div>
    <div id="lessonText" style="margin-top:8px"></div>
  </div>

  <!-- Keyboard & Drill stacked and centered -->
  <div class="card stack-center">
    <div style="font-weight:700; margin-bottom:8px;">Keyboard & Finger Map</div>

    <!-- Keyboard -->
    <div id="keyboard" aria-label="Keyboard diagram">
      <div class="krow">
        <span class="key" data-finger="lp">Q</span><span class="key" data-finger="lr">W</span><span class="key" data-finger="lm">E</span><span class="key" data-finger="li">R</span><span class="key" data-finger="li">T</span>
        <span class="key" data-finger="ri">Y</span><span class="key" data-finger="ri">U</span><span class="key" data-finger="rm">I</span><span class="key" data-finger="rr">O</span><span class="key" data-finger="rp">P</span>
      </div>
      <div class="krow">
        <span class="key" data-finger="lp">A</span><span class="key" data-finger="lr">S</span><span class="key" data-finger="lm">D</span><span class="key" data-finger="li">F</span><span class="key" data-finger="li">G</span>
        <span class="key" data-finger="ri">H</span><span class="key" data-finger="ri">J</span><span class="key" data-finger="rm">K</span><span class="key" data-finger="rr">L</span><span class="key" data-finger="rp">;</span>
      </div>
      <div class="krow">
        <span class="key" data-finger="lp">Z</span><span class="key" data-finger="lr">X</span><span class="key" data-finger="lm">C</span><span class="key" data-finger="li">V</span><span class="key" data-finger="li">B</span>
        <span class="key" data-finger="ri">N</span><span class="key" data-finger="ri">M</span><span class="key" data-finger="rm">,</span><span class="key" data-finger="rr">.</span><span class="key" data-finger="rp">/</span>
      </div>
    </div>

    <!-- Tips -->
    <ul class="muted tips" style="margin-top:12px;">
      <li>Keep wrists straight and relaxed. Elbows at ~90°.</li>
      <li>Place index fingers on F and J (feel the bumps).</li>
      <li>Eyes on screen; return to home row after each key.</li>
    </ul>

    <!-- Drill: full-width block UNDER keyboard -->
    <div class="card drill" aria-label="Typing drill">
      <div><strong>Drill</strong> <span class="muted" style="margin-left:12px">Goal: 95%+ accuracy</span></div>
      <div style="font-size:20px; margin-top:8px;">
        <span id="typed" style="color:var(--ok)"></span><span id="remain" style="color:var(--muted)"></span>
      </div>
      <input id="input" placeholder="Type the drill here…" autocomplete="off" spellcheck="false" style="width:100%; font-size:18px; margin-top:8px">
      <div id="stats" class="muted" style="margin-top:8px">WPM: 0 · Accuracy: 100% · Errors: 0</div>
      <div id="progress" class="muted" style="margin-top:6px">Progress: —</div>
    </div>
  </div>

  <script>
    // --- Theme ---
    const htmlEl = document.documentElement;
    const themeModeEl = document.getElementById("themeMode");
    const mediaDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
    function applyTheme(mode){
      if(mode==='auto'){ htmlEl.setAttribute('data-theme', mediaDark&&mediaDark.matches? 'dark':'light'); }
      else { htmlEl.setAttribute('data-theme', mode); }
      localStorage.setItem("tof_theme", mode); themeModeEl.value = mode;
    }
    mediaDark && mediaDark.addEventListener('change', ()=>{ const saved = localStorage.getItem("tof_theme")||'auto'; if(saved==='auto') applyTheme('auto'); });
    (function initTheme(){
      const saved = localStorage.getItem("tof_theme")||'auto'; themeModeEl.value = saved; applyTheme(saved);
      themeModeEl.addEventListener("change", ()=>applyTheme(themeModeEl.value));
    })();

    // --- Lessons data ---
    const LESSONS = [
      { id:"home-row", title:"Home Row Basics",
        text:"Place index fingers on F and J (small bumps). Keep wrists relaxed; return to home row after each key.",
        drills:[ { name:"Home Row 1", text:"ffff jjjj f j fj jf jjff jjff" },
                 { name:"Home Row 2", text:"asdf ;lkj as df ;l kj jkl; aaaa ssss dddd ffff ;;;; llll kkkk jjjj" } ]},
      { id:"index-strength", title:"Index Finger Strength",
        text:"Build accuracy with index-finger stretches (R,T,F,G,V,B) and (Y,U,H,J,N,M). Keep shoulders relaxed.",
        drills:[ { name:"Left Index", text:"rfrf gtgt vbvb rgtv rgtv" },
                 { name:"Right Index", text:"jyjy huhu nmnm jyhn jyhn" } ]},
      { id:"punctuation", title:"Punctuation & Symbols",
        text:"Practice common punctuation. Keep the same posture and return to home row.",
        drills:[ { name:"Comma & Period", text:"a,a. a,a. j.j, j.j," },
                 { name:"Semicolon", text:"; ;;; ; ;;; ;;;;" } ]}
    ];

    const FINGER_BY_KEY = {
      q:"lp", a:"lp", z:"lp",  w:"lr", s:"lr", x:"lr",  e:"lm", d:"lm", c:"lm",
      r:"li", f:"li", v:"li", t:"li", g:"li", b:"li",
      y:"ri", h:"ri", n:"ri", u:"ri", j:"ri", m:"ri",
      i:"rm", k:"rm", ",":"rm",  o:"rr", l:"rr", ".":"rr",  p:"rp", ";":"rp", "/":"rp"
    };

    // --- DOM ---
    const bannerEl = document.getElementById("banner");
    const lessonSelect = document.getElementById("lessonSelect");
    const lessonText = document.getElementById("lessonText");
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");
    const typedEl = document.getElementById("typed");
    const remainEl = document.getElementById("remain");
    const inputEl = document.getElementById("input");
    const statsEl = document.getElementById("stats");
    const progressEl = document.getElementById("progress");

    function showBanner(type,msg){
      bannerEl.textContent = msg||"";
      bannerEl.style.display = msg? "block":"none";
      bannerEl.style.color = (type==="error")? "var(--err)" : (type==="success")? "var(--ok)" : "var(--accent)";
    }

    // --- Progress storage ---
    const keyFor = id => `tof_lesson_${id}_progress`;
    const saveProgress = (id, idx, bestAcc) => localStorage.setItem(keyFor(id), JSON.stringify({ idx, bestAcc }));
    const loadProgress = id => { try{ return JSON.parse(localStorage.getItem(keyFor(id))||"{}"); }catch{ return {}; } };

    // --- Populate lessons ---
    function populateLessons(){
      lessonSelect.innerHTML = LESSONS.map((L,i)=>`<option value="${L.id}">${i+1}. ${L.title}</option>`).join("");
    }

    // --- Drill state ---
    let curLesson=null, curIdx=0, startTs=0, errs=0;
    function highlightFingerFor(ch){
      document.querySelectorAll("#keyboard .key").forEach(el=>el.classList.remove("highlight"));
      const f = FINGER_BY_KEY[(ch||"").toLowerCase()]; if(!f) return;
      document.querySelectorAll(`#keyboard .key[data-finger="${f}"]`).forEach(el=>el.classList.add("highlight"));
    }
    function loadLesson(id){
      curLesson = LESSONS.find(x=>x.id===id) || LESSONS[0];
      lessonText.textContent = curLesson.text;
      const p = loadProgress(curLesson.id);
      curIdx = Math.min(p.idx||0, curLesson.drills.length-1);
      updateProgressUI(p.bestAcc);
      loadDrill(curIdx);
    }
    function loadDrill(idx){
      const d = curLesson.drills[idx];
      typedEl.textContent=""; remainEl.textContent = d.text;
      inputEl.value=""; startTs=0; errs=0;
      highlightFingerFor(d.text.trim()[0]);
      inputEl.focus();
    }
    function updateProgressUI(bestAcc){
      const total = curLesson.drills.length;
      progressEl.textContent = `Lesson progress: ${curIdx}/${total} drills completed · Best accuracy: ${bestAcc!=null?bestAcc+"%":"—"}`;
    }

    // --- Input handling ---
    inputEl.addEventListener("input", ()=>{
      if(!curLesson) return;
      const target = curLesson.drills[curIdx].text;
      const typed = inputEl.value;
      if(!startTs && typed.length>0) startTs = performance.now();

      let i=0; while(i<typed.length && typed[i]===target[i]) i++;
      typedEl.textContent = target.slice(0,i);
      remainEl.textContent = target.slice(i);
      highlightFingerFor(target[i]);

      // metrics
      const elapsed = startTs? (performance.now()-startTs)/1000 : 0;
      const minutes = elapsed/60;
      const grossWPM = minutes>0 ? Math.round(((i)/5)/minutes) : 0;
      const acc = typed.length ? Math.max(0, (1 - Math.max(0, typed.length - i)/typed.length))*100 : 100;
      statsEl.textContent = `WPM: ${grossWPM} · Accuracy: ${Math.round(acc)}% · Errors: ${Math.max(0, typed.length - i)}`;

      // complete drill
      if(i === target.length){
        showBanner("success","Great! Drill completed. Press Start for next drill or keep practicing.");
        const finalAcc = Math.round(acc);
        const p = loadProgress(curLesson.id);
        const best = Math.max(p.bestAcc||0, finalAcc);
        if(finalAcc >= 95 && curIdx < (curLesson.drills.length-1)){
          curIdx += 1; // unlock next
          saveProgress(curLesson.id, curIdx, best);
          updateProgressUI(best);
        } else {
          saveProgress(curLesson.id, curIdx, best);
          updateProgressUI(best);
        }
      }
    });

    // --- Controls ---
    lessonSelect.addEventListener("change", ()=> loadLesson(lessonSelect.value));
    startBtn.addEventListener("click", ()=> { loadDrill(curIdx); showBanner("", ""); });
    resetBtn.addEventListener("click", ()=> {
      if(!curLesson) return;
      localStorage.removeItem(`tof_lesson_${curLesson.id}_progress`);
      curIdx = 0;
      updateProgressUI(null);
      loadDrill(curIdx);
      showBanner("","Progress cleared for this lesson.");
    });

    // --- Init ---
    // Theme auto
    (()=>{
      const mediaDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
      function applyTheme(mode){
        if(mode==='auto'){ htmlEl.setAttribute('data-theme', mediaDark&&mediaDark.matches? 'dark':'light'); }
        else { htmlEl.setAttribute('data-theme', mode); }
        localStorage.setItem("tof_theme", mode); themeModeEl.value = mode;
      }
      mediaDark && mediaDark.addEventListener('change', ()=>{ const saved = localStorage.getItem("tof_theme")||'auto'; if(saved==='auto') applyTheme('auto'); });
      const saved = localStorage.getItem("tof_theme")||'auto'; themeModeEl.value = saved; applyTheme(saved);
      themeModeEl.addEventListener("change", ()=>applyTheme(themeModeEl.value));
    })();

    populateLessons();
    loadLesson(lessonSelect.value || LESSONS[0].id);
  </script>
</body>
</html>
